on:
  workflow_call:
    inputs:
      set-property-command:
        required: false
        type: string

jobs:
  release_master:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        name: checkout master
        id: checkout
        #with:
          #path: secure-api-gateway-parent

      - name: remove project snapshot
        run: |
          ls -al
          mvn help:evaluate -Dexpression=project.version -q -DforceStdout
          mvn versions:set -DremoveSnapshot -DgenerateBackupPoms

      - name: Release version
        run: |
          ls -al
          mvn help:evaluate -Dexpression=project.version -q -DforceStdout
          echo "VERSION=$( mvn help:evaluate -Dexpression=project.version -q -DforceStdout )" >> $GITHUB_ENV"
          echo "Version is: ${{ env.VERSION }}

      - name: create release branch
        run: |
          git checkout -b release/${{ env.VERSION }}
          ls -al
          cat pom.xml
          git branch -l

      - name: update dependencies
        run: |
          echo "Command to execute: ${{ inputs.set-property-command }}"
          ${{ inputs.set-property-command }}
